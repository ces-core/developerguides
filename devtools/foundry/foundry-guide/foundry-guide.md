# Introduction to Foundry

**Level:** Intermediate  
**Estimated Time:** 15 - 30 min

<!-- vim-markdown-toc GFM -->

- [Overview](#overview)
- [Set up a wallet](#set-up-a-wallet)
  - [Create a keystore directory](#create-a-keystore-directory)
  - [Generate a keystore file](#generate-a-keystore-file)
    - [Word of caution](#word-of-caution)
  - [Create a password file (optional)](#create-a-password-file-optional)
- [Connect to a node](#connect-to-a-node)

<!-- vim-markdown-toc -->

## Overview

> Foundry is a blazing fast, portable and modular toolkit for Ethereum application development written in Rust.

You will find instructions on how to set up Foundry in the following links:

- Foundry Repo: https://github.com/foundry-rs/foundry
- Foundry Book: https://book.getfoundry.sh

## Set up a wallet

**⚠️ WARNING:** The context of this section are relevant for the current versions of Foundry components:

```
forge 0.2.0 (116f4c2 2022-06-17T00:15:44.951123847Z)
cast 0.2.0 (116f4c2 2022-06-17T00:15:44.951123847Z)
```

In the future, Foundry may improve the UX for wallet management which can make this section irrelevant. There is an
[open issue](https://github.com/foundry-rs/foundry/issues/1869) regarding this topic in Foundry's main repo.

Some guides in this repo provide convenience wrappers on top of Foundry commands to handle wallets the same way
[dapp.tools](https://dapp.tools) did. For that to work, you are required to set up a keystore.

### Create a keystore directory

The default place for a keystore is `${HOME}/.ethereum/keystore/`, so you can create it:

```bash
mkdir -p "${HOME}/.etherem/keystore"
```

### Generate a keystore file

Next you need to generate a keystore file from your private key. You can use
[`eth-keys@1.1.4`](https://www.npmjs.com/package/eth-keys/v/1.1.4) for that.

```bash
yarn global add 'eth-keys@1.1.4'
```

---

#### Word of caution

**⚠️ WARNING: DON'T TRUST, VERIFY!** Carefully read through the following section.

Be careful when providing your private key to unknown code.

`eth-keys@1.1.4` code has carefully been inspected at the time of this writing and there was no malicious code or attack
vectors to be explored. However, most package registries out there cannot guarantee immutability and NPM is no exception
to that rule.

You probably want to inspect the code of `eth-keys` by yourself after it has been installed to your system. If you are
using `yarn` standalone, you can use the `yarn global list` command to find where it is in your file system. Follow any
existing symlinks and you will end up in a directory with a structure similar to:

```
.
├── LICENSE
├── node_modules
├── package.json
├── README.md
├── src
│   ├── bin
│   ├── index.js
│   └── index.ts
└── tsconfig.json
```

The main file for this repo is `src/index.ts`. You can inspect it and see if it does not make weird external calls or if
it leaves room for attacks (i.e.: assign your private key to an environment variable). Don't take this analysis lightly,
specially if you will provide it with a private key which will control real assets.

However, the file ultimately being executed is `src/index.js`, which is automatically generated by the `typescript`
compiler, so it can be hard to read. Still, there is no guarantee that the `src/index.js` file was generated from the
same `src/index.ts` in this directory. The only way to be sure is by making the compilation yourself.

Make sure you are in the `eth-keys` package root directory and then run:

```bash
mv index.js index.js.bkp # make a backup of the current JS file
yarn tsc -p . # run the typescript compiler for the project
```

Now try to see if there is any difference between the freshly compiled file and the previous one:

```
diff src/index.js src/index.js.bkp
```

Ideally there will be no difference. This way you will ensure that the `src/index.js` file does exactly what
`src/index.ts` does.

The `eth-keys@1.1.4` source code installed in a Linux machine as described in this guide will produce the SHA1 checksum
when the following command is run:

```bash
find . -type f \( -exec sha1sum "$PWD"/{} \; \) | awk '{print $1}' | sort | sha1sum
```

Result:

```
>   12daca79d3428f52ac8e9f210272d303f0e5135b  -
```

If you can get the same result, it means that the content is the same, and therefore it should be safe to run.
Nevertheless, if you are using Mac or Windows, you might get different results for the same source code because of
differences in character encoding.

---

Make sure you are in the keystore directory:

```bash
cd "${HOME}/.etherem/keystore"
```

Then run `eth-keys`:

```bash
eth-keys
```

Fill in the prompts like the image below:

![eth-keys-instructions](https://i.imgur.com/0tsesY6.png)

**⚠️ IMPORTANT:** The exact keystore name is not important, however it **MUST** include the wallet address. Letter case
and doesn't matter and the _0x_ prefix can be omitted.

### Create a password file (optional)

If you are comfortable doing this, you can create a plain-text file containing the password for the keystore file you
provided above and set the `FOUNDRY_ETH_PASSWORD_FILE` variable in `.env` to **the path that file**. Otherwise, Foundry
will prompt you for your password every time you need to send a transaction.

To create a password file you can:

```bash
touch "${HOME}/.eth-password" # Creates the file; the name or location doesn't matter
chmod 0600 "${HOME}/.eth-password" # Prevents other users in the system from accessing it
# Edit the file and type-in/paste the password
```

## Connect to a node

If you don't have a local RPC endpoint for an Ethereum node or if it is running in and endpoint different than
`http://localhost:8545`, you need to set it:

```bash
# For Goerli
export ETH_RPC_URL=https://eth-goerli.alchemyapi.io/v2/<YOUR_ALCHEMY_API_KEY>

# For Mainnet
export ETH_RPC_URL=https://eth-mainnet.alchemyapi.io/v2/<YOUR_ALCHEMY_API_KEY>
```

Then run:

```bash
cast chain
```

The result should be the name of the network you are currently connected to:

```
>   goerli
# It would have been 'ethlive' for mainnet
```
